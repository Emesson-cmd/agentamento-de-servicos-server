generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

////////////////////
/// ENUMS
////////////////////

enum UserRole {
  ADMIN
  BARBER
  CLIENT
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELED
  COMPLETED
  NO_SHOW
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
  CANCELED
}

enum PaymentMethod {
  CASH
  PIX
  CREDIT_CARD
  DEBIT_CARD
}

////////////////////
/// MODELS
////////////////////

model User {
  id                  String    @id @default(cuid())
  name                String
  email               String    @unique
  password            String
  phone               String?
  role                UserRole
  resetToken          String?
  resetTokenExpiresAt DateTime?
  isActive            Boolean   @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relations
  barber Barber?
  client Client?
}

model BarberShop {
  id          String  @id @default(cuid())
  name        String
  description String?
  phone       String?
  address     String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relations
  barbers      Barber[]
  services     Service[]
  appointments Appointment[]
}

model Barber {
  id           String @id @default(cuid())
  userId       String @unique
  barberShopId String

  bio             String?
  experienceYears Int?
  isAvailable     Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relations
  user         User             @relation(fields: [userId], references: [id])
  barberShop   BarberShop       @relation(fields: [barberShopId], references: [id])
  services     BarberService[]
  schedules    BarberSchedule[]
  appointments Appointment[]
  reviews      Review[]
}

model Client {
  id     String @id @default(cuid())
  userId String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relations
  user         User          @relation(fields: [userId], references: [id])
  appointments Appointment[]
  reviews      Review[]
}

model Service {
  id           String @id @default(cuid())
  barberShopId String

  name        String
  description String?
  price       Decimal @db.Decimal(10, 2)
  durationMin Int

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relations
  barberShop   BarberShop      @relation(fields: [barberShopId], references: [id])
  barbers      BarberService[]
  appointments Appointment[]
}

model BarberService {
  id        String @id @default(cuid())
  barberId  String
  serviceId String

  /// Relations
  barber  Barber  @relation(fields: [barberId], references: [id])
  service Service @relation(fields: [serviceId], references: [id])

  @@unique([barberId, serviceId])
}

model BarberSchedule {
  id       String @id @default(cuid())
  barberId String

  weekday   Int /// 0 = Sunday, 6 = Saturday
  startTime String /// "09:00"
  endTime   String /// "18:00"

  createdAt DateTime @default(now())

  /// Relations
  barber Barber @relation(fields: [barberId], references: [id])

  @@unique([barberId, weekday])
}

model Appointment {
  id           String @id @default(cuid())
  barberShopId String
  barberId     String
  clientId     String
  serviceId    String

  date   DateTime
  status AppointmentStatus @default(PENDING)
  notes  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  /// Relations
  barberShop BarberShop @relation(fields: [barberShopId], references: [id])
  barber     Barber     @relation(fields: [barberId], references: [id])
  client     Client     @relation(fields: [clientId], references: [id])
  service    Service    @relation(fields: [serviceId], references: [id])
  payment    Payment?
  review     Review?
}

model Payment {
  id            String @id @default(cuid())
  appointmentId String @unique

  amount Decimal       @db.Decimal(10, 2)
  method PaymentMethod
  status PaymentStatus @default(PENDING)

  paidAt    DateTime?
  createdAt DateTime  @default(now())

  /// Relations
  appointment Appointment @relation(fields: [appointmentId], references: [id])
}

model Review {
  id            String @id @default(cuid())
  appointmentId String @unique
  barberId      String
  clientId      String

  rating  Int /// 1 a 5
  comment String?

  createdAt DateTime @default(now())

  /// Relations
  appointment Appointment @relation(fields: [appointmentId], references: [id])
  barber      Barber      @relation(fields: [barberId], references: [id])
  client      Client      @relation(fields: [clientId], references: [id])
}
